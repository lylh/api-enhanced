# 音质级别说明文档

## 概述

本项目支持多种音质级别，从标准音质到超清母带，满足不同用户的音质需求。所有音质级别按照从高到低的顺序排列，解灰系统会自动从请求的音质级别开始向下遍历，直到找到可用的音源。

## 音质级别详细说明

### 1. jymaster - 超清母带 (最高音质)
- **码率**: 5.7Mbps FLAC
- **格式**: FLAC 无损
- **特点**: 网易云音乐的最高音质级别，提供接近录音室母带的音质体验
- **适用场景**: 发烧友级别的音质需求，需要高端音响设备才能充分体现其优势
- **文件大小**: 约 42MB/分钟

### 2. sky - 沉浸环绕声
- **码率**: 2.3Mbps FLAC
- **格式**: FLAC 无损 + 环绕声效果
- **特点**: 支持多声道环绕声效果，提供沉浸式音频体验
- **适用场景**: 支持环绕声的音响系统或耳机
- **文件大小**: 约 17MB/分钟

### 3. jyeffect - 高清环绕声
- **码率**: 3.0Mbps FLAC
- **格式**: FLAC 无损 + 音效增强
- **特点**: 在无损音质基础上增加了音效处理
- **适用场景**: 追求音效体验的用户
- **文件大小**: 约 22MB/分钟

### 4. hires - Hi-Res 高解析度音频
- **码率**: 962kbps FLAC
- **格式**: FLAC 无损
- **特点**: 高解析度音频，采样率通常为 48kHz/24bit 或更高
- **适用场景**: 高品质音响设备，追求细节还原的用户
- **文件大小**: 约 7MB/分钟

### 5. lossless - 无损音质
- **码率**: 962kbps FLAC
- **格式**: FLAC 无损
- **特点**: 标准的无损音质，与 CD 音质相当
- **适用场景**: 大多数高品质音响设备，平衡音质和文件大小
- **文件大小**: 约 7MB/分钟

### 6. exhigh - 极高音质
- **码率**: 320kbps MP3
- **格式**: MP3 有损压缩
- **特点**: MP3 格式的最高音质，对于大多数用户已经足够
- **适用场景**: 普通音响设备，移动设备播放
- **文件大小**: 约 2.4MB/分钟

### 7. standard - 标准音质
- **码率**: 128kbps MP3
- **格式**: MP3 有损压缩
- **特点**: 基础音质，文件小，适合网络条件较差的环境
- **适用场景**: 网络带宽有限，存储空间有限的场景
- **文件大小**: 约 1MB/分钟

## 音质级别优先级

系统按照以下优先级顺序进行音质级别的自动降级：

```
jymaster → sky → jyeffect → hires → lossless → exhigh → standard
```

## 解灰逻辑说明

当用户请求某个音质级别时，系统会：

1. 首先尝试获取用户请求的音质级别
2. 如果请求的音质级别不可用，自动降级到下一个可用的音质级别
3. 继续向下遍历，直到找到可用的音源或所有级别都尝试完毕

## 音质级别映射

在解灰逻辑中，各音质级别对应的优先级数值：

```javascript
const qualityLevels = {
  'standard': 1,
  'higher': 2,      // 兼容性级别
  'exhigh': 3,
  'lossless': 4,
  'hires': 5,
  'sky': 6,
  'jyeffect': 7,
  'jymaster': 8
}
```

## 使用建议

### 网络环境考虑
- **高速网络**: 可以选择 `jymaster` 或 `sky` 获得最佳音质体验
- **中速网络**: 推荐使用 `lossless` 或 `hires`，平衡音质和加载速度
- **低速网络**: 建议使用 `exhigh` 或 `standard`，确保流畅播放

### 设备兼容性
- **高端音响**: 充分利用 `jymaster`、`sky` 等高音质级别
- **普通耳机**: `lossless` 或 `exhigh` 已经能提供很好的体验
- **移动设备**: `exhigh` 通常是最佳选择，兼顾音质和电量消耗

### 存储空间考虑
- **充足存储**: 可以缓存高音质级别的音乐
- **有限存储**: 建议使用 `exhigh` 或 `standard`，节省存储空间

## 技术实现

所有音质级别的定义和处理逻辑分布在以下文件中：

- `server.js`: 主服务器的音质级别定义和解灰逻辑
- `module/song_url_v1.js`: v1 版本的歌曲链接获取
- `module/song_url_unblock.js`: 专门的解灰模块
- `module/song_url_enhanced.js`: 增强版歌曲链接获取

所有文件中的音质级别数组保持一致，确保系统的统一性和可维护性。